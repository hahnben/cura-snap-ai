# JWT secret from Supabase (required for authentication)
# WARNING: In production, SUPABASE_JWT_SECRET environment variable MUST be set
# The fallback value is only for local development and testing
supabase.jwt.secret=${SUPABASE_JWT_SECRET}

# PostgreSQL DB connection via Supabase Shared Pooler
# For development, you can set DATABASE_URL environment variable
# or use the test profile with: --spring.profiles.active=test
spring.datasource.url=${DATABASE_URL}

# Hibernate and SQL formatting (development defaults)
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:none}
spring.jpa.show-sql=${SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=true

# Database auto-configuration (will be disabled if no DATABASE_URL is set)
spring.autoconfigure.exclude=${AUTOCONFIGURE_EXCLUDE:}

# Agent Service Configuration
agent.service.url=${AGENT_SERVICE_URL:http://localhost:8001}
agent.service.enabled=${AGENT_SERVICE_ENABLED:true}

# Transcription Service Configuration
transcription.service.url=${TRANSCRIPTION_SERVICE_URL:http://localhost:8002}
transcription.service.enabled=${TRANSCRIPTION_SERVICE_ENABLED:true}
transcription.service.timeout=${TRANSCRIPTION_SERVICE_TIMEOUT:30000}

# Multipart File Upload Configuration (Fallback Security Limits)
# Primary limits should be enforced by Caddy reverse proxy
spring.servlet.multipart.max-file-size=25MB
spring.servlet.multipart.max-request-size=30MB
spring.servlet.multipart.enabled=true
spring.servlet.multipart.file-size-threshold=2KB

# Redis Configuration for Async Processing and Caching
# SECURITY: All Redis settings MUST use environment variables in production
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.database=${REDIS_DATABASE:0}
spring.data.redis.password=${REDIS_PASSWORD:defaultpass}
spring.data.redis.enabled=${REDIS_ENABLED:true}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0
spring.data.redis.lettuce.pool.max-wait=-1ms

# SECURITY: Actuator endpoint protection
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=when-authorized

# Async Processing Configuration
spring.task.execution.pool.core-size=4
spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=async-

# Audio Job Worker Configuration (Legacy - now superseded by Worker Pool)
app.audio.worker.enabled=${AUDIO_WORKER_ENABLED:false}
app.audio.worker.processing-interval=${AUDIO_WORKER_INTERVAL:5000}
app.audio.worker.max-concurrent-jobs=${AUDIO_WORKER_MAX_JOBS:5}

# Worker Pool Configuration (Enhanced Multi-Worker System)
app.worker.pool.enabled=${WORKER_POOL_ENABLED:true}
app.worker.pool.audio.size=${WORKER_POOL_AUDIO_SIZE:2}
app.worker.pool.text.size=${WORKER_POOL_TEXT_SIZE:1}
app.worker.pool.processing.interval=${WORKER_POOL_PROCESSING_INTERVAL:5000}
app.worker.pool.shutdown.timeout=${WORKER_POOL_SHUTDOWN_TIMEOUT:30}

# Worker Health Service Configuration
app.worker.health.enabled=${WORKER_HEALTH_ENABLED:true}
app.worker.health.heartbeat.interval=${WORKER_HEALTH_HEARTBEAT_INTERVAL:30}
app.worker.health.failure.threshold=${WORKER_HEALTH_FAILURE_THRESHOLD:5}
